Инструкция по запуску.

1. Для запуска приложения необходимо клонировать репозиторий.
   Для этого выполните в консоли команду: git clone https://github.com/sergeyvakhrin/ske_test_work_v_2.git
   Перед этим, необходимо установить Git себе на компьютер  https://git-scm.com/download/win 

2. Заполните файл .env по примеру .env.sample

3. Если вы работаете на Windows, то установите и запустите WSL

4. Установите и запустите https://docs.docker.com/engine/install/ под свою систему

5. Перейдите в корневой каталог приложения и выполните команду в консоли: docker-compose up -d --build

6. Web и Backend приложения будет доступно по адресу http://127.0.0.1:8000/

7. Если база пользователей пустая, то первый пользователь создается с правами администратора.

8. Инструкции по API будут доступны по адресу http://127.0.0.1:8000/redoc/ или http://127.0.0.1:8000/swagger/

9. Административная панель доступна по адресу http://127.0.0.1:8000/admin/ 


Как это работает.


1. Web интерфейс.

При первом обращении на http://127.0.0.1:8000/ попадаем на главную страницу сервиса.
В верхней части экрана имеется меню. Справа можно нажать на "три полоски", откроется меню Навигации.
Для входа в сервис необходима Регистрация. Заполняем карточку регистрации и нажимаем зарегистрироваться.
Первый пользователь создается с правами Администратора, добавляется в группу Moderators, и имеет доступ к Админ панели.
При заполнении карточки регистрации необходимо указать тип пользователя (Завод, Розничная сеть или Индивидуальный Предприниматель)
Если выбирается Розничная сеть или Индивидуальный Предприниматель еще нужно указать Поставщика.
Без указания поставщика Розничная сеть или Индивидуальный Предприниматель не смогут приобретать товары.

Далее попадаем на страницу авторизации. Вводим почту и пароль.
При успешной авторизации попадаем в карточку предприятия. Где имеем возможность изменять реквизиты, видеть поставщика,
переходить на страницу поставщика, видеть задолженность перед поставщиком.
Пользователи с правами Администратора имеют возможность быстрого перехода в админ панель.

В меню навигации имеются пункты Продукты, Склад, Клиенты Сети.

Продукты.

В разделе Продукты перечислена вся номенклатура Сети.
Все пользователи могут просматривать подробную информацию о продуктах.
Пользователи с правами Администратора могут добавлять и изменять товары. А также имеют возможность быстрого перехода
в админ панель.

Склад.

В разделе склад, пользователи могут просматривать перечень продуктов на своем складе, создавать новый приход и
просматривать товары на складе своего поставщика.
Пользователи с правами Администратора могут просматривать товары на всех складах и создавать новые записи на любой склад.

Клиенты Сети.

В разделе Клиенты Сети, пользователи могут видеть всех зарегистрированных пользователей сети и просматривать о них
информацию.
Пользователи с правами Администратора могут видеть все пользователей с задолженностью перед поставщиками, 
их подробную информацию и редактировать данные, в том числе Тип клиента, Поставщика и задолженность.


2. Админ панель.

Админ панель доступна по адресу http://127.0.0.1:8000/admin/.
Попадаем на страницу авторизации.
Пользователя необходимо завести заранее либо в web приложении (первый пользователь Админ),
либо с помощью команды python manage.py csu.

Администратор может: 

    - просматривать список пользователей
    - добавлять пользователей
    - Просматривать информацию о пользователях. В информации есть ссылка на поставщика (ТЗ)
    - редактировать реквизиты пользователей 
    - делать пользователей административным персоналом
    - создавать группы пользователей и различными правами
    - удалять пользователей (При удалении пользователя, удаляются записи по складу. Если у пользователя были покупатели,
                            они все автоматически пере привязываются к предыдущему по иерархии в сети поставщику.)  
    - отдельной командой "Обнулить задолженность перед поставщиком" (ТЗ) убрать задолженность одного или группы пользователей
    - осуществлять поиск и фильтрацию по пользователям по Названию организации, Типу клиента и городу (ТЗ)

    - просматривать список продуктов
    - добавлять продукты в номенклатуру
    - просматривать информацию о продукте
    - редактировать данные о продукте
    - делать продукт не активным
    - осуществлять поиск и фильтрацию по названию, моделе, описанию, активности и дате выхода продукта
    
    - просматривать записи склада товаров пользователей
    - добавлять записи в склад для любого пользователя
    - просматривать подрробную информацию о записи в складе
    - удалять записи в складе
    - осуществлять поиск и фильтрацию по организации, продукты, количеству и цена
    

Администратор не может:

    - менять поставщика пользователя
    - вручную менять задолженность пользователя перед поставщиком
 
    - менять дату выхода продукта на рынок
    - удалять продукт - продукт становится не активным
    
    - добавлять запись в склад если у поставщика нет на складе этого товара
    - добавлять запись в склад с нулевым количеством или ценой
    - изменять данные о записи в складе


3. API интерфейс.

3.1. Регистрация.

Отправляется POST-запрос на /users/api/register/
    {
    "email": "individual5@mail.ru",
    "password": "1234",
    "name": "ИП Марков П.Р.",
    "country": "Россия",
    "city": "Тамбов",
    "street": null,
    "house_number": null,
    "client_type": "INDIVIDUAL",
    "supplier": 2,
    "debt": 0
    }
Если такого пользователя еще нет в системе, получаем код 201.

3.2. Авторизация.

Отправляется POST-запрос на /users/api/login/
    {
    "email": "individual5@mail.ru",
    "password": "1234"
    }
Если пользователь зарегистрирован в системе, получаем код 200 и токены "access" и "refresh"

3.3. Получаем список пользователей (только для группы Moderators).

Отправляем GET-запрос на /users/api/list/?search=Country
Вместо "Country" указываем название страны, если необходимо сортировать по стране.

Получаем код 200 если зарегистрированный пользователь является администратором.
Получаем список пользователей с иерархией сети покупателей.
    {
            "id": 5,
            "password": "...",
            "last_login": null,
            "date_joined": "2025-01-27T07:24:45.609150Z",
            "email": "individual5@mail.ru",
            "name": "ИП Марков П.Р.",
            "country": "Россия",
            "city": "Тамбов",
            "street": null,
            "house_number": null,
            "client_type": "INDIVIDUAL",
            "created_at": "2025-01-27",
            "debt": 0.0,
            "supplier": 2,
            "groups": [],
            "user_permissions": [],
            "buyers": null
        },
        {
            "id": 2,
            "password": "...",
            "last_login": "2025-01-24T10:25:40.523447Z",
            "date_joined": "2025-01-23T11:42:41.199295Z",
            "email": "factory@mail.ru",
            "name": "Завод имени Ленина",
            "country": "Россия",
            "city": "Самара",
            "street": null,
            "house_number": "1",
            "client_type": "FACTORY",
            "created_at": "2025-01-23",
            "debt": 0.0,
            "supplier": null,
            "groups": [],
            "user_permissions": [],
            "buyers": [
                {
                    "id": 7,
                    "password": "...",
                    "last_login": null,
                    "date_joined": "2025-01-28T09:27:22.051972Z",
                    "email": "individual6@mail.ru",
                    "name": "ИП Марков П.К.",
                    "country": "Россия",
                    "city": "Тамбов",
                    "street": null,
                    "house_number": null,
                    "client_type": "INDIVIDUAL",
                    "created_at": "2025-01-28",
                    "debt": 0.0,
                    "supplier": 2,
                    "groups": [],
                    "user_permissions": [],
                    "buyers": null
                },

3.4. Получаем информацию по пользователю (сам пользователь или группа Moderators).

Отправляем GET-запрос на /users/api/{id}/
    {
            "id": 2,
            "password": "...",
            "last_login": "2025-01-24T10:25:40.523447Z",
            "date_joined": "2025-01-23T11:42:41.199295Z",
            "email": "factory@mail.ru",
            "name": "Завод имени Ленина",
            "country": "Россия",
            "city": "Самара",
            "street": null,
            "house_number": "1",
            "client_type": "FACTORY",
            "created_at": "2025-01-23",
            "debt": 0.0,
            "supplier": null,
            "groups": [],
            "user_permissions": [],
            "buyers": [
                {
                    "id": 7,
                    "password": "...",
                    "last_login": null,
                    "date_joined": "2025-01-28T09:27:22.051972Z",
                    "email": "individual6@mail.ru",
                    "name": "ИП Марков П.К.",
                    "country": "Россия",
                    "city": "Тамбов",
                    "street": null,
                    "house_number": null,
                    "client_type": "INDIVIDUAL",
                    "created_at": "2025-01-28",
                    "debt": 0.0,
                    "supplier": 2,
                    "groups": [],
                    "user_permissions": [],
                    "buyers": null
                },

3.5. Изменение данных пользователя.

Отправляем PUT-запрос на /users/api/update/{id}/
    {
    "email": "individual3@mail.ru",
    "password": "1234",
    "name": "ИП Марков В.П.",
    "country": "Россия",
    "city": "Тамбов",
    "street": null,
    "house_number": null
    }
Полу debt "Задолженность перед поставщиком" для редактирования не доступно (ТЗ).

3.6. Удаление пользователей (только для группы Moderators).

Отправляем DELETE-запрос на /users/api/delete/{id}/
Если у пользователя есть товар на остатках, получим ошибку 500 с сообщением
"Нельзя удалить организацию. Сначала переместите товар на другой склад."

В случае успешного удаления пользователя, его покупатели автоматически перепривязываюся к предыдущему по
иерархии поставщику.

3.7. Создание продукта.

Отправляется POST-запрос на /api/product/create/
    {
    "name": "Телевизор",
    "model_product": "Радуга",
    "description": "Цветной",
    "photo": null,
    "is_published": true,
    "release_date": "2025-01-20"
    }

3.8. Получаем список продуктов.
    
Отправляем GET-запрос на /api/product/list/?search=word
Вместо "word" указываем поисковое слово, если необходимо сделать фильтрацию.
Поиск ведется по названию, модели и описанию.

3.9. Получаем информацию о продукте.

Отправляем GET-запрос на /api/product/{id}/

3.10. Изменяем данные продукта.

Отправляем PUT-запрос на /api/product/update/{id}/
    {
    "name": "Телефон2",
    "model_product": "LG P5002",
    "description": "Смартфон2",
    "photo": null,
    "is_published": true,
    "release_date": "2025-01-20"
    }

3.11. Удаляем продукт.

Отправляем DELETE-запрос на /api/product/delete/{id}/

Если товар числится на складе, получаем ошибку 500 и сообщение:
"Нельзя удалить товар, если он находится на складе у клиента. Товар убран из продажи".
Товар убирается из продажи.

3.12. Создание записи на складе.

Отправляем POST-запрос на /api/warehouse/create/
    {
    "user": 23,
    "product": 10,
    "quantity": 5,
    "price": 5000
    }

3.13. Получаем все записи склада (только для группы Moderators).

Отправляем GET-запрос на /api/warehouse/list/?search=product
Вместо "product" указываем поисковое слово, если необходимо сделать фильтрацию.
Поиск ведется по названию продукта.

3.14. Получаем информацию по записи склада (только для тек, к кому относится запись или группы Moderators)

Отправляем GET-запрос на /api/warehouse/{id}/

3.15. Удаление записи склада (только для группы Moderators). 

Отправляем DELETE-запрос на /api/warehouse/delete/{id}/
Получаем ошибку 500 с сообщением
"Нельзя удалять операции по складу без соответствующих документов!"



Технические требования
Python 3.8+
Django 3+
DRF 3.10+
PostgreSQL 10+
При выполнении тестового задания вы можете дополнительно использовать любые сторонние Python-библиотеки без всяких ограничений.

Задание
Создайте веб-приложение с API-интерфейсом и админ-панелью.
Создайте базу данных, используя миграции Django.
Требования к реализации:

Необходимо реализовать модель сети по продаже электроники.
Сеть должна представлять собой иерархическую структуру из трех уровней:

завод;
розничная сеть;
индивидуальный предприниматель.
Каждое звено сети ссылается только на одного поставщика оборудования (не обязательно предыдущего по иерархии). Важно отметить, что уровень иерархии определяется не названием звена, а отношением к остальным элементам сети, т. е. завод всегда находится на уровне 0, а если розничная сеть относится напрямую к заводу, минуя остальные звенья, ее уровень — 1.

Каждое звено сети должно обладать следующими элементами:
Название.
Контакты:
email,
страна,
город,
улица,
номер дома.
Продукты:
название,
модель,
дата выхода продукта на рынок.
Поставщик (предыдущий по иерархии объект сети).
Задолженность перед поставщиком в денежном выражении с точностью до копеек.
Время создания (заполняется автоматически при создании).
Сделать вывод в админ-панели созданных объектов.
На странице объекта сети добавить:

ссылку на «Поставщика»;
фильтр по названию города;
admin action, очищающий задолженность перед поставщиком у выбранных объектов.
Используя DRF, создать набор представлений:
CRUD для модели поставщика (запретить обновление через API поля «Задолженность перед поставщиком»).

Добавить возможность фильтрации объектов по определенной стране.

Настроить права доступа к API так, чтобы только активные сотрудники имели доступ к API.
